<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macierz odwrotna</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            text-align: center;
            margin: 20px;
        }
        table {
            margin: 10px auto;
            border-collapse: collapse;
        }
        td {
            border: 1px solid #e0e0e0;
            padding: 5px 10px;
            text-align: center;
        }
        input {
            width: 50px;
            text-align: center;
            background-color: #2c2c2c;
            color: #e0e0e0;
            border: 1px solid #e0e0e0;
        }
        .matrix {
            display: inline-block;
            margin: 10px;
        }
        button {
            background-color: #3f51b5;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #303f9f;
        }
    </style>
</head>
<body>
    <h1>Obliczanie macierzy odwrotnej</h1>
    <div id="matrix" class="matrix"></div>
    <p>Podaj macierz odwrotną (zaokrągloną do 2 miejsc po przecinku):</p>
    <div id="inverseInput"></div>
    <button onclick="checkInverse()">Sprawdź wynik</button>
    <p id="feedback"></p>
    <p id="correctResult"></p>

    <script>
        function getRandomSize(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateMatrix(size) {
            let matrix = [];
            for (let i = 0; i < size; i++) {
                let row = [];
                for (let j = 0; j < size; j++) {
                    row.push(Math.floor(Math.random() * 10) - 5); // Liczby od -5 do 4
                }
                matrix.push(row);
            }
            return matrix;
        }

        function displayMatrix(matrix, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<table>' + matrix.map(row => 
                '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>'
            ).join('') + '</table>';
        }

        function displayInverseInput(size) {
            const container = document.getElementById('inverseInput');
            container.innerHTML = '<table>' + Array.from({ length: size }, (_, i) => 
                '<tr>' + Array.from({ length: size }, (_, j) => 
                `<td><input type="number" step="0.01" id="cell-${i}-${j}" /></td>`
            ).join('') + '</tr>'
            ).join('') + '</table>';
        }

        function calculateDeterminant(matrix) {
            const size = matrix.length;
            if (size === 2) {
                // Dla 2x2: ad - bc
                return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
            }
            if (size === 3) {
                // Dla 3x3
                return (
                    matrix[0][0] * (matrix[1][1] * matrix[2][2] - matrix[1][2] * matrix[2][1]) -
                    matrix[0][1] * (matrix[1][0] * matrix[2][2] - matrix[1][2] * matrix[2][0]) +
                    matrix[0][2] * (matrix[1][0] * matrix[2][1] - matrix[1][1] * matrix[2][0])
                );
            }
        }

        function calculateInverse(matrix) {
            const size = matrix.length;
            const determinant = calculateDeterminant(matrix);

            if (determinant === 0) {
                throw new Error("Macierz nieodwracalna (wyznacznik = 0).");
            }

            if (size === 2) {
                // Dla 2x2: 1/det * [d, -b; -c, a]
                return [
                    [matrix[1][1] / determinant, -matrix[0][1] / determinant],
                    [-matrix[1][0] / determinant, matrix[0][0] / determinant],
                ];
            }

            if (size === 3) {
                // Dla 3x3: metoda dopełnień algebraicznych
                let adjugate = [];
                for (let i = 0; i < size; i++) {
                    let row = [];
                    for (let j = 0; j < size; j++) {
                        // Podmacierz do obliczania dopełnienia
                        let subMatrix = matrix
                            .filter((_, r) => r !== i)
                            .map(row => row.filter((_, c) => c !== j));

                        // Obliczanie dopełnienia i znak (-1)^(i+j)
                        const cofactor = calculateDeterminant(subMatrix) * (i + j % 2 === 0 ? 1 : -1);
                        row.push(cofactor);
                    }
                    adjugate.push(row);
                }

                // Transponowanie macierzy dopełnień i skalowanie przez 1/det
                return adjugate[0].map((_, col) =>
                    adjugate.map(row => Math.round((row[col] / determinant) * 100) / 100)
                );
            }
        }

        function checkInverse() {
            let correct = true;
            let userMatrix = [];
            for (let i = 0; i < inverseMatrix.length; i++) {
                let userRow = [];
                for (let j = 0; j < inverseMatrix[0].length; j++) {
                    const inputField = document.getElementById(`cell-${i}-${j}`);
                    const userValue = parseFloat(inputField.value);

                    if (isNaN(userValue)) {
                        correct = false;
                        break;
                    }

                    userRow.push(userValue);
                    if (Math.abs(userValue - inverseMatrix[i][j]) > 0.01) {
                        correct = false;
                    }
                }
                userMatrix.push(userRow);
            }

            if (userMatrix.flat().some(isNaN)) {
                document.getElementById('feedback').textContent = 'Proszę wypełnić wszystkie pola!';
            } else if (correct) {
                document.getElementById('feedback').textContent = 'Poprawna odpowiedź!';
            } else {
                document.getElementById('feedback').textContent = 'Błędna odpowiedź!';
                document.getElementById('correctResult').textContent = 'Poprawna macierz odwrotna: ' + JSON.stringify(inverseMatrix);
            }
        }

        // Generowanie macierzy kwadratowej (2x2 lub 3x3)
        const size = getRandomSize(2, 3);
        let matrix;
        let inverseMatrix;
        while (true) {
            try {
                matrix = generateMatrix(size);
                inverseMatrix = calculateInverse(matrix);
                break; // Wyjście z pętli, jeśli macierz ma odwrotność
            } catch (e) {
                console.log("Wygenerowano macierz nieodwracalną, ponawiam losowanie...");
            }
        }

        // Wyświetlanie macierzy i pól do wprowadzenia odpowiedzi
        displayMatrix(matrix, 'matrix');
        displayInverseInput(size);
    </script>
</body>
</html>
